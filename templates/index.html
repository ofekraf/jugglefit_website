{% extends "macros/base.html" %}

{% block content %}
    </section>
</main>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    function initCarousel(selector) {
        const container = document.querySelector(selector);
        if (!container) return;
        
        const carousel = container.querySelector('.carousel');
        const items = carousel.querySelectorAll('.event-card');
        const prevBtn = container.parentElement.querySelector('.prev-btn');
        const nextBtn = container.parentElement.querySelector('.next-btn');
        
        if (items.length <= 2) {
            prevBtn.style.display = 'none';
            nextBtn.style.display = 'none';
            return;
        }
        
        let currentIndex = 0;
        let isAnimating = false;
        
        function getItemWidth() {
            const item = items[0];
            const style = window.getComputedStyle(item);
            const marginRight = parseInt(style.marginRight);
            return item.offsetWidth + marginRight;
        }
        
        function updateCarousel(animate = true) {
            if (!animate) {
                carousel.style.transition = 'none';
                setTimeout(() => {
                    carousel.style.transition = '';
                }, 10);
            }
            const itemWidth = getItemWidth();
            const offset = -currentIndex * itemWidth;
            carousel.style.transform = `translateX(${offset}px)`;
        }

        function updateButtons() {
            const itemsPerView = window.innerWidth <= 768 ? 1 : 2;
            const maxIndex = items.length - itemsPerView;
            
            // Disable prev button at start
            prevBtn.style.opacity = currentIndex === 0 ? '0.5' : '1';
            prevBtn.style.pointerEvents = currentIndex === 0 ? 'none' : 'auto';
            
            // Disable next button at end
            nextBtn.style.opacity = currentIndex >= maxIndex ? '0.5' : '1';
            nextBtn.style.pointerEvents = currentIndex >= maxIndex ? 'none' : 'auto';
        }

        function slide(direction) {
            if (isAnimating) return;
            
            const itemsPerView = window.innerWidth <= 768 ? 1 : 2;
            const maxIndex = items.length - itemsPerView;
            const newIndex = currentIndex + direction;
            
            if (newIndex < 0 || newIndex > maxIndex) return;
            
            isAnimating = true;
            currentIndex = newIndex;
            updateCarousel();
            updateButtons();
            
            setTimeout(() => {
                isAnimating = false;
            }, 500);
        }

        prevBtn.addEventListener('click', () => slide(-1));
        nextBtn.addEventListener('click', () => slide(1));

        // Handle window resize
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                updateCarousel(false);
                updateButtons();
            }, 250);
        });

        // Initialize carousel
        updateCarousel(false);
        updateButtons();
    }

    // Initialize both carousels
    initCarousel('#upcoming_events .carousel');
    initCarousel('#last_events .carousel');
});
</script>
{% endblock %}