{% extends "macros/base.html" %}
{% block title %}Past Events{% endblock %}
{% block scripts %}
<script src="{{ url_for('static', filename='js/siteswap_x.js') }}"></script>
{% endblock %}
{% block content %}

<div class="past-events-page">
    <div class="section-container">
        <h1 class="section-title">Past JuggleFit Competitions</h1>
        <p class="section-description">Explore the history of JuggleFit competitions, showcasing past events, their locations, routes, and champions.</p>
        {% include "macros/siteswap_x_toggle.html" %}
    </div>
    {% for event in past_events[::-1] %}
    {% set event_id = "event-" ~ loop.index %}
    <div class="past-event-button-container">
        <button class="past-event-button primary-button" onclick="toggle_object('{{ event_id }}')">{{ event.name }}</button>
    </div>
    <div class="past-event-container hidden" id="{{ event_id }}">
        <ul>
            <li><strong>Date: </strong>{{ event.date.strftime('%d/%m/%Y') }}</li>
            <li><strong>Location: </strong>{{ event.location }}</li>
            <li><strong>Routes & Winners:</strong>
                <div class="event-image-container">
                    <img src="{{ event.image_url }}" alt="{{ event.name }} winners" class="event-winners-image">
                </div>
                <ul>
                    {% for result in event.results %}
                    {% set route_id = event_id ~ "-route-" ~ loop.index %}
                    <li class="route-result-item">
                        <div class="route-result-header">
                            <div class="route-result-info">
                                <strong>{{ result.route.name }}</strong> - Winner: {{ result.competitors[1].name }}
                                {% if result.competitors[1].seconds %}
                                    ({{ "%02d"|format(result.competitors[1].seconds // 60) }}:{{ "%02d"|format(result.competitors[1].seconds % 60) }})
                                {% else %}
                                    ({{ result.competitors[1].tricks_accomplished }}/10 tricks)
                                {% endif %}
                            </div>
                            <button class="primary-button" onclick="toggle_object('{{ route_id }}')">Show Route</button>
                        </div>
                        <div class="route-container hidden" id="{{ route_id }}">
                            {% with route=result.route %}
                                {% include "macros/route_display.html" %}
                                <div class="route-button-container">
                                    <a href="/created_route?route={{ result.route.serialize() | urlencode }}" class="primary-button outline">Try it Yourself</a>
                                </div>
                            {% endwith %}
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            </li>
        </ul>
    </div>
    {% endfor %}
</div>

<script>
function toggle_object(object_id) {
    const object = document.getElementById(object_id);
    if (object) {
        if (object.classList.contains('hidden')) {
            object.classList.remove('hidden');
            // Scroll to the element with smooth behavior
            object.scrollIntoView({ behavior: 'smooth', block: 'start' });
        } else {
            object.classList.add('hidden');
        }
    }
}

// Function to handle URL hash
function handleHash() {
    const hash = decodeURIComponent(window.location.hash.substring(1)); // Remove the # symbol and decode
    if (hash) {
        // Find the button that contains this event name
        const buttons = document.querySelectorAll('.past-event-button');
        for (const button of buttons) {
            if (button.textContent.trim() === hash) {
                button.click();
                break;
            }
        }
    }
}

// Handle hash on page load
document.addEventListener('DOMContentLoaded', handleHash);

// Handle hash changes
window.addEventListener('hashchange', handleHash);
</script>
{% endblock %}