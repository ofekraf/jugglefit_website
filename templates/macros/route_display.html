{% block content %}
<div class="route-page">
    <div class="route-header">
        <h1 class="route-title">{{ route.name }}</h1>
    </div>

    <div class="route-container">
        <div class="route-content">
            <div class="route-sections">
                {% set trick_counter = namespace(count=0) %}
                {% set current_props = namespace(count=none) %}
                {% for trick in route.tricks %}
                    {% if current_props.count != trick.props_count %}
                        {% if not loop.first %}
                            </div>
                        </div>
                        {% endif %}
                        <div class="prop-section">
                            <div class="prop-color-bar" data-props="{{ trick.props_count }}" data-prop-type="{{ route.prop }}">
                                <div class="prop-count">
                                    <div class="prop-count-text">X {{ trick.props_count }}</div>
                                </div>
                            </div>
                            <div class="trick-container">
                        {% set current_props.count = trick.props_count %}
                    {% endif %}
                    {% set trick_counter.count = trick_counter.count + 1 %}
                    <div class="prop-details-frame">
                        <div class="trick-content">
                            <div class="trick-main">
                                <span class="trick-number">{{ trick_counter.count }}.</span>
                                <span class="trick-name" data-name="{{ trick.text or trick.name }}" data-siteswap-x="{{ trick.siteswap_x }}">{{ trick.text or trick.name }}</span>
                                <span class="trick-siteswap-x" style="display:none">{{ trick.siteswap_x if trick.siteswap_x else (trick.text or trick.name) }}</span>
                                {% if trick.comment %}
                                    <span class="trick-comment">[{{ trick.comment }}]</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% if loop.last %}
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="siteswap-x-toggle no-print">
        <label>
            <input type="checkbox" id="siteswap-x-toggle-checkbox">
            Siteswap-X notation
        </label>
    </div>

</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const toggleCheckbox = document.getElementById('siteswap-x-toggle-checkbox');
        if (toggleCheckbox) {
            toggleCheckbox.addEventListener('change', function() {
                const trickNames = document.querySelectorAll('.trick-name');
                const trickSiteswaps = document.querySelectorAll('.trick-siteswap-x');
                if (this.checked) {
                    trickNames.forEach((el, i) => {
                        if (trickSiteswaps[i] && trickSiteswaps[i].textContent.trim()) {
                            el.style.display = 'none';
                            trickSiteswaps[i].style.display = '';
                        } else {
                            el.style.display = '';
                            if (trickSiteswaps[i]) trickSiteswaps[i].style.display = 'none';
                        }
                    });
                } else {
                    trickNames.forEach((el, i) => {
                        el.style.display = '';
                        if (trickSiteswaps[i]) trickSiteswaps[i].style.display = 'none';
                    });
                }
            });
        }
    });
</script>
{% endblock %}
